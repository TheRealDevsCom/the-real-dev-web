<div id="ai-circuit" class="absolute inset-0">
  <canvas id="ai-circuit-canvas"></canvas>
</div>

<script>
  // -----------------------------
  // ðŸ”· MÃS MÃ“DULOS EMPRESARIALES
  // -----------------------------
  const MODULES = [
    { x: 0.1, y: 0.12, w: 0.16, h: 0.16, label: 'API Gateway' },
    { x: 0.7, y: 0.12, w: 0.16, h: 0.16, label: 'Orchestrator' },
    { x: 0.1, y: 0.55, w: 0.18, h: 0.18, label: 'Auth Service' },
    { x: 0.7, y: 0.55, w: 0.18, h: 0.18, label: 'Data Lake' },

    // Nuevos mÃ³dulos
    { x: 0.4, y: 0.1, w: 0.16, h: 0.14, label: 'AI Engine' },
    { x: 0.4, y: 0.33, w: 0.16, h: 0.14, label: 'ML Models' },
    { x: 0.4, y: 0.58, w: 0.16, h: 0.14, label: 'Queue System' },
    { x: 0.15, y: 0.82, w: 0.18, h: 0.14, label: 'Logger' },
    { x: 0.65, y: 0.82, w: 0.18, h: 0.14, label: 'Notifications' },
    { x: 0.07, y: 0.33, w: 0.12, h: 0.14, label: 'Cache' },
    { x: 0.82, y: 0.33, w: 0.12, h: 0.14, label: 'CDN' },
    { x: 0.4, y: 0.82, w: 0.16, h: 0.14, label: 'Billing Service' }
  ]

  // -----------------------------
  // ðŸ”· MÃS CIRCUITOS CONECTADOS
  // -----------------------------
  const CIRCUITS = [
    // Originales
    { from: 0, to: 1, bend: 0.5, color: '#2a4a5a' },
    { from: 0, to: 2, bend: 0.25, color: '#4a4a3a' },
    { from: 1, to: 3, bend: 0.75, color: '#3a4a3a' },
    { from: 2, to: 3, bend: 0.5, color: '#4a3a4a' },
    { from: 0, to: 3, bend: 0.3, color: '#3a3f44' },

    // ðŸ”¥ NUEVOS CIRCUITOS (mÃ¡s densidad y rutas)
    { from: 4, to: 0, bend: 0.35, color: '#2a4a5a' },
    { from: 4, to: 1, bend: 0.6, color: '#4a4a3a' },
    { from: 4, to: 5, bend: 0.45, color: '#3a3f44' },
    { from: 5, to: 6, bend: 0.5, color: '#3a4a3a' },
    { from: 6, to: 3, bend: 0.65, color: '#2a4a5a' },

    { from: 7, to: 2, bend: 0.4, color: '#4a3a4a' },
    { from: 7, to: 6, bend: 0.3, color: '#3a4a3a' },
    { from: 8, to: 3, bend: 0.6, color: '#3a3f44' },

    { from: 9, to: 0, bend: 0.2, color: '#2a4a5a' },
    { from: 10, to: 1, bend: 0.8, color: '#4a4a3a' },
    { from: 9, to: 5, bend: 0.4, color: '#3a4a3a' },
    { from: 10, to: 5, bend: 0.6, color: '#4a3a4a' },

    { from: 11, to: 4, bend: 0.4, color: '#3a3f44' },
    { from: 11, to: 6, bend: 0.5, color: '#2a4a5a' }
  ]

  const SPEED = 0.003
  let progress = 0

  const canvas = document.querySelector('#ai-circuit-canvas')
  const container = document.querySelector('#ai-circuit')
  const ctx = canvas.getContext('2d')

  // -----------------------------
  // ðŸ”· DIBUJO DE MÃ“DULOS
  // -----------------------------
  function drawModule(m, width, height) {
    const x = m.x * width
    const y = m.y * height
    const w = m.w * width
    const h = m.h * height

    ctx.strokeStyle = 'rgba(255,255,255,0.16)'
    ctx.lineWidth = 0.7
    ctx.strokeRect(x, y, w, h)

    ctx.font = '10px sans-serif'
    ctx.fillStyle = 'rgba(255,255,255,0.5)'
    ctx.fillText(m.label, x + 10, y + 20)
  }

  function getModuleCenter(m, width, height) {
    return {
      x: m.x * width + (m.w * width) / 2,
      y: m.y * height + (m.h * height) / 2
    }
  }

  // -----------------------------
  // ðŸ”· RUTAS ESTILO CIRCUITO
  // -----------------------------
  function drawCircuit(route, width, height) {
    const from = getModuleCenter(MODULES[route.from], width, height)
    const to = getModuleCenter(MODULES[route.to], width, height)

    ctx.beginPath()
    ctx.moveTo(from.x, from.y)
    ctx.quadraticCurveTo(width * route.bend, height * 0.5, to.x, to.y)

    ctx.strokeStyle = 'rgba(255,255,255,0.08)'
    ctx.lineWidth = 2
    ctx.stroke()
  }

  // -----------------------------
  // ðŸ”· PULSOS ANIMADOS
  // -----------------------------
  function drawPulse(route, width, height) {
    const t = progress % 1

    const from = getModuleCenter(MODULES[route.from], width, height)
    const to = getModuleCenter(MODULES[route.to], width, height)

    const cx = (1 - t) * (1 - t) * from.x + 2 * (1 - t) * t * (width * route.bend) + t * t * to.x

    const cy = (1 - t) * (1 - t) * from.y + 2 * (1 - t) * t * (height * 0.5) + t * t * to.y

    ctx.beginPath()
    ctx.arc(cx, cy, 3, 0, Math.PI * 2)
    ctx.fillStyle = route.color
    ctx.shadowColor = route.color
    ctx.shadowBlur = 12
    ctx.fill()
    ctx.shadowBlur = 0
  }

  function setup() {
    const width = container.clientWidth
    const height = container.clientHeight
    const dpr = window.devicePixelRatio || 1

    canvas.width = width * dpr
    canvas.height = height * dpr
    canvas.style.width = width + 'px'
    canvas.style.height = height + 'px'
    ctx.scale(dpr, dpr)

    requestAnimationFrame(frame)
  }

  function frame() {
    const width = container.clientWidth
    const height = container.clientHeight

    ctx.clearRect(0, 0, width, height)

    MODULES.forEach((m) => drawModule(m, width, height))
    CIRCUITS.forEach((c) => drawCircuit(c, width, height))
    CIRCUITS.forEach((c) => drawPulse(c, width, height))

    progress += SPEED
    requestAnimationFrame(frame)
  }

  const resizeObserver = new ResizeObserver(setup)
  resizeObserver.observe(container)
</script>
